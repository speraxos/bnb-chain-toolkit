{
  "ERC-8004 Register Agent (web3.py)": {
    "prefix": "erc8004-register",
    "body": [
      "from web3 import Web3",
      "import json",
      "import base64",
      "",
      "# Connect to BSC Testnet",
      "w3 = Web3(Web3.HTTPProvider('${1:https://data-seed-prebsc-1-s1.bnbchain.org:8545}'))",
      "",
      "IDENTITY_REGISTRY = '${2:0x8004A818BFB912233c491871b3d84c89A494BD9e}'",
      "ABI = [",
      "    {",
      "        'inputs': [{'name': 'agentURI', 'type': 'string'}],",
      "        'name': 'register',",
      "        'outputs': [{'name': 'agentId', 'type': 'uint256'}],",
      "        'stateMutability': 'nonpayable',",
      "        'type': 'function'",
      "    },",
      "    {",
      "        'inputs': [{'name': 'tokenId', 'type': 'uint256'}],",
      "        'name': 'tokenURI',",
      "        'outputs': [{'name': '', 'type': 'string'}],",
      "        'stateMutability': 'view',",
      "        'type': 'function'",
      "    },",
      "    {",
      "        'inputs': [{'name': 'tokenId', 'type': 'uint256'}],",
      "        'name': 'ownerOf',",
      "        'outputs': [{'name': '', 'type': 'address'}],",
      "        'stateMutability': 'view',",
      "        'type': 'function'",
      "    }",
      "]",
      "",
      "contract = w3.eth.contract(address=IDENTITY_REGISTRY, abi=ABI)",
      "",
      "",
      "def register_agent(private_key: str, agent_uri: str) -> int:",
      "    \"\"\"Register a new ERC-8004 agent.\"\"\"",
      "    account = w3.eth.account.from_key(private_key)",
      "    tx = contract.functions.register(agent_uri).build_transaction({",
      "        'from': account.address,",
      "        'nonce': w3.eth.get_transaction_count(account.address),",
      "        'gas': 300000,",
      "    })",
      "    signed = w3.eth.account.sign_transaction(tx, private_key)",
      "    tx_hash = w3.eth.send_raw_transaction(signed.raw_transaction)",
      "    receipt = w3.eth.wait_for_transaction_receipt(tx_hash)",
      "    print(f'Registered in tx: {receipt.transactionHash.hex()}')",
      "    return receipt",
      "",
      "",
      "def build_data_uri(metadata: dict) -> str:",
      "    \"\"\"Build a base64 data URI from metadata dict.\"\"\"",
      "    json_bytes = json.dumps(metadata).encode('utf-8')",
      "    b64 = base64.b64encode(json_bytes).decode('ascii')",
      "    return f'data:application/json;base64,{b64}'"
    ],
    "description": "Register an ERC-8004 agent using web3.py"
  },
  "ERC-8004 View Agent (web3.py)": {
    "prefix": "erc8004-view",
    "body": [
      "from web3 import Web3",
      "import json",
      "import base64",
      "",
      "w3 = Web3(Web3.HTTPProvider('${1:https://data-seed-prebsc-1-s1.bnbchain.org:8545}'))",
      "IDENTITY_REGISTRY = '${2:0x8004A818BFB912233c491871b3d84c89A494BD9e}'",
      "",
      "ABI = [",
      "    {",
      "        'inputs': [{'name': 'tokenId', 'type': 'uint256'}],",
      "        'name': 'tokenURI',",
      "        'outputs': [{'name': '', 'type': 'string'}],",
      "        'stateMutability': 'view',",
      "        'type': 'function'",
      "    },",
      "    {",
      "        'inputs': [{'name': 'tokenId', 'type': 'uint256'}],",
      "        'name': 'ownerOf',",
      "        'outputs': [{'name': '', 'type': 'address'}],",
      "        'stateMutability': 'view',",
      "        'type': 'function'",
      "    }",
      "]",
      "",
      "contract = w3.eth.contract(address=IDENTITY_REGISTRY, abi=ABI)",
      "",
      "",
      "def view_agent(token_id: int) -> dict:",
      "    \"\"\"View an ERC-8004 agent's details.\"\"\"",
      "    owner = contract.functions.ownerOf(token_id).call()",
      "    uri = contract.functions.tokenURI(token_id).call()",
      "    ",
      "    metadata = {}",
      "    if uri.startswith('data:application/json;base64,'):",
      "        b64 = uri.replace('data:application/json;base64,', '')",
      "        metadata = json.loads(base64.b64decode(b64).decode('utf-8'))",
      "    ",
      "    return {",
      "        'tokenId': token_id,",
      "        'owner': owner,",
      "        'uri': uri,",
      "        'metadata': metadata",
      "    }"
    ],
    "description": "View an ERC-8004 agent using web3.py"
  }
}
