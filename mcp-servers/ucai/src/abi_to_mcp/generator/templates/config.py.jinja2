"""
Configuration for {{ server_name }} MCP Server.

Contract: {{ contract_address }}
Network: {{ network }}

Generated by UCAI (https://github.com/nirholas/UCAI)
"""

import os
from dotenv import load_dotenv

# Load environment variables from .env file
load_dotenv()


# =============================================================================
# Network Configuration
# =============================================================================

NETWORK = "{{ network }}"
CHAIN_ID = {{ chain_id }}

# RPC endpoint - override with RPC_URL environment variable
DEFAULT_RPC_URL = "{{ default_rpc }}"
RPC_URL = os.environ.get("RPC_URL", DEFAULT_RPC_URL)


# =============================================================================
# Contract Configuration
# =============================================================================

CONTRACT_ADDRESS = os.environ.get("CONTRACT_ADDRESS", "{{ contract_address }}")


# =============================================================================
# Authentication (for write operations)
# =============================================================================

# ⚠️ SECURITY: Never commit private keys to version control!
# Set via environment variable only
PRIVATE_KEY = os.environ.get("PRIVATE_KEY")


# =============================================================================
# Server Configuration
# =============================================================================

SERVER_NAME = "{{ server_name }}"
SERVER_VERSION = "{{ server_version }}"


# =============================================================================
# Safety Settings
# =============================================================================

# If True, write operations simulate by default (safer)
SIMULATION_DEFAULT = {{ simulation_default | default(true, true) }}

# If True, all write operations are disabled
READ_ONLY_MODE = {{ read_only | default(false, true) }}


# =============================================================================
# Transaction Settings
# =============================================================================

# Multiplier for gas estimation (1.2 = 20% buffer)
GAS_LIMIT_MULTIPLIER = float(os.environ.get("GAS_LIMIT_MULTIPLIER", "1.2"))

# Maximum gas price in Gwei (protection against high gas)
MAX_GAS_PRICE_GWEI = int(os.environ.get("MAX_GAS_PRICE_GWEI", "500"))

# Transaction confirmation timeout in seconds
TX_TIMEOUT = int(os.environ.get("TX_TIMEOUT", "120"))


# =============================================================================
# Logging
# =============================================================================

LOG_LEVEL = os.environ.get("LOG_LEVEL", "INFO")


# =============================================================================
# Validation
# =============================================================================

def validate_config():
    """Validate configuration and return list of errors."""
    errors = []

    if not CONTRACT_ADDRESS:
        errors.append("CONTRACT_ADDRESS is not set")

    if not RPC_URL:
        errors.append("RPC_URL is not set")

    # Check address format
    if CONTRACT_ADDRESS and not CONTRACT_ADDRESS.startswith("0x"):
        errors.append(f"Invalid CONTRACT_ADDRESS format: {CONTRACT_ADDRESS}")

    if CONTRACT_ADDRESS and len(CONTRACT_ADDRESS) != 42:
        errors.append(f"Invalid CONTRACT_ADDRESS length: {CONTRACT_ADDRESS}")

    return errors


def require_signer():
    """Check if signer is configured, raise if not."""
    if not PRIVATE_KEY:
        raise ValueError(
            "PRIVATE_KEY environment variable is required for write operations. "
            "Set it in your .env file or environment."
        )
